Процедура ЗаполнитьДиаграммуПоУслугам()

Запрос = Новый Запрос;
Запрос.Текст =
    "ВЫБРАТЬ
    |    Продажи.Номенклатура КАК Номенклатура,
    |    СУММА(Продажи.СуммаОборот) КАК СуммаОборот
    |ПОМЕСТИТЬ ВТ_КонкретныеУслуги
    |ИЗ
    |    РегистрНакопления.Продажи.Обороты(&ДатаНачала, &ДатаОкончания, Регистратор, Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипНоменклатуры.Услуга)) КАК Продажи
    |ГДЕ
    |    Продажи.КоличествоОборот <> 0
    |
    |СГРУППИРОВАТЬ ПО
    |    Продажи.Номенклатура
    |;
    |
|////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    |    СУММА(ПродажиОбороты.СуммаОборот) КАК СуммаОборот
    |ПОМЕСТИТЬ ВТ_ВсеПродажи
    |ИЗ
    |    РегистрНакопления.Продажи.Обороты(&ДатаНачала, &ДатаОкончания, Регистратор, Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипНоменклатуры.Услуга)) КАК ПродажиОбороты
    |;
    |
|////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    |    ВТ_КонкретныеУслуги.Номенклатура КАК Номенклатура,
    |    ВТ_КонкретныеУслуги.СуммаОборот КАК СуммаПродажНоменклатуры,
    |    ВТ_ВсеПродажи.СуммаОборот КАК ОбщаяСуммаПоУслугам
    |ПОМЕСТИТЬ ВТ_Предытог
    |ИЗ
    |    ВТ_КонкретныеУслуги КАК ВТ_КонкретныеУслуги
    |        ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ВсеПродажи КАК ВТ_ВсеПродажи
    |        ПО (ИСТИНА)
    |;
    |
|////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    |    ВЫБОР
    |        КОГДА 100 * ВТ_Предытог.СуммаПродажНоменклатуры / ВТ_Предытог.ОбщаяСуммаПоУслугам > 10
    |            ТОГДА ВТ_Предытог.Номенклатура.Представление
    |        ИНАЧЕ ""Прочее""
    |    КОНЕЦ КАК Номенклатура,
    |    СУММА(ВТ_Предытог.СуммаПродажНоменклатуры) КАК Сумма
    |ИЗ
    |    ВТ_Предытог КАК ВТ_Предытог
    |
    |СГРУППИРОВАТЬ ПО
    |    ВЫБОР
    |        КОГДА 100 * ВТ_Предытог.СуммаПродажНоменклатуры / ВТ_Предытог.ОбщаяСуммаПоУслугам > 10
    |            ТОГДА ВТ_Предытог.Номенклатура.Представление
    |        ИНАЧЕ ""Прочее""
    |    КОНЕЦ";

Запрос.УстановитьПараметр("ДатаНачала", ПериодОбработки);
Запрос.УстановитьПараметр("ДатаОкончания", КонецМесяца(ПериодОбработки));

ДиаграммаПоУслугам.Обновление = Ложь; //1
ДиаграммаПоУслугам.Очистить();

Точка = ДиаграммаПоУслугам.Точки.Добавить("Сумма"); //2
Точка.Текст = "Сумма";
Точка.ПриоритетЦвета = Ложь;

Выборка = Запрос.Выполнить().Выбрать();
Пока Выборка.Следующий() Цикл

    Серия = ДиаграммаПоУслугам.Серии.Добавить(Выборка.Номенклатура); //3
    ДиаграммаПоУслугам.УстановитьЗначение(Точка, Серия, Выборка.Сумма, Строка(Выборка.Сумма));

КонецЦикла;

ДиаграммаПоУслугам.Обновление = Истина;

КонецПроцедуры
Процедура ЗаполнитьДиаграммуПоСотрудникам()

Запрос = Новый Запрос;
Запрос.Текст =
        "ВЫБРАТЬ
        |    СУММА(Продажи.СуммаОборот) КАК Сумма,
        |    Продажи.Сотрудник.Представление КАК Сотрудник
        |ИЗ
        |    РегистрНакопления.Продажи.Обороты(&ДатаНачала, &ДатаОкончания, Регистратор, ) КАК Продажи
        |ГДЕ
        |    Продажи.КоличествоОборот <> 0
        |
        |СГРУППИРОВАТЬ ПО
        |    Продажи.Сотрудник.Представление";

Запрос.УстановитьПараметр("ДатаНачала", ПериодОбработки);
Запрос.УстановитьПараметр("ДатаОкончания", КонецМесяца(ПериодОбработки));

ДиаграммаВыручкаПоСотрудникам.Обновление = Ложь;
ДиаграммаВыручкаПоСотрудникам.Очистить();

Точка = ДиаграммаВыручкаПоСотрудникам.Точки.Добавить("Сумма");
Точка.Текст = "Сумма";
Точка.ПриоритетЦвета = Ложь;

Выборка = Запрос.Выполнить().Выбрать();
Пока Выборка.Следующий() Цикл

    Серия = ДиаграммаВыручкаПоСотрудникам.Серии.Добавить(Выборка.Сотрудник);
    ДиаграммаВыручкаПоСотрудникам.УстановитьЗначение(Точка, Серия, Выборка.Сумма, Строка(Выборка.Сумма));

КонецЦикла;

ДиаграммаВыручкаПоСотрудникам.Обновление = Истина;

КонецПроцедуры
